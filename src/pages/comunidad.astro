---
import Layout from '../layouts/Layout.astro';

interface User {
    name: {
        first: string;
        last: string;
    };
    picture: {
        medium: string;
    };
}

// Fetch de datos en el servidor (build time o SSR)
const response = await fetch('https://randomuser.me/api/?results=12&nat=es,us,fr');
const data = await response.json();


const users: User[] = data.results;

const comentarios = [
    "¡La mejor experiencia de mi vida! La organización fue impecable.",
    "Increíble el nivel de los speakers y el ambiente del evento.",
    "Definitivamente volveré el próximo año. ¡El merchandising es top!",
    "Me encantó la facilidad para comprar las entradas y el acceso.",
    "Un evento único. Conocí a mucha gente interesante de la industria.",
    "La app funcionó de maravilla, todo muy fluido y rápido.",
    "El workshop de diseño fue revelador, aprendí muchísimo.",
    "La comida del catering estaba deliciosa, gran detalle.",
    "Me llevo contactos muy valiosos para mi carrera profesional.",
    "Una oportunidad perfecta para hacer networking de calidad.",
    "Los talleres prácticos superaron mis expectativas, muy aplicables.",
    "La atención a los detalles en cada stand marca la diferencia."
];
---

<Layout title="Comunidad | Maserati">
    <section id="comunidad" class="relative min-h-screen py-20 overflow-hidden bg-maserati-negro pt-32">
    
        <div class="absolute top-0 left-0 z-0 w-full h-full overflow-hidden pointer-events-none">
            <div class="absolute top-[-10%] right-[-5%] w-96 h-96 bg-maserati-azul/10 rounded-full blur-3xl"></div>
            <div class="absolute bottom-[-10%] left-[-5%] w-96 h-96 bg-maserati-amber/5 rounded-full blur-3xl"></div>
        </div>

        <div class="relative z-10 px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
            
            <div class="mb-16 text-center opacity-0 header-animate translate-y-4">
                <h2 class="mb-4 text-3xl font-bold text-white md:text-4xl">
                    Lo que dice la <span class="text-maserati-amber">Comunidad</span>
                </h2>
                <p class="max-w-2xl mx-auto text-lg text-maserati-plata">
                    Conoce a algunos de los asistentes que ya tienen su entrada y forman parte de la familia del Tridente.
                </p>
            </div>

            <div class="grid grid-cols-1 gap-8 community-grid md:grid-cols-2 lg:grid-cols-3">
            
                {users.map((user, index) => (
                    <article class="relative p-6 transition-colors duration-300 border opacity-0 community-card translate-y-8 group rounded-2xl bg-maserati-gris/20 border-white/5 hover:border-maserati-azul/50 hover:-translate-y-1 hover:shadow-lg backdrop-blur-sm">
                    
                        <div class="flex items-center gap-4 mb-4">
                            <div class="relative shrink-0">
                                <div class="absolute inset-0 transition-opacity opacity-70 rounded-full bg-linear-to-tr from-maserati-azul to-maserati-amber blur-[2px] group-hover:opacity-100"></div>
                                <img 
                                    src={user.picture.medium} 
                                    alt={`${user.name.first} ${user.name.last}`}
                                    class="relative object-cover border-2 rounded-full w-14 h-14 border-maserati-negro"
                                    loading="lazy"
                                />
                            </div>
                            
                            <div>
                                <h3 class="text-lg font-bold leading-tight text-white transition-colors group-hover:text-maserati-amber">
                                    {user.name.first} {user.name.last}
                                </h3>
                                <span class="text-xs uppercase tracking-wider text-maserati-plata/60">
                                    Asistente Verificado
                                </span>
                            </div>
                        </div>

                        <p class="relative pl-2 text-sm italic leading-relaxed text-maserati-plata">
                            <span class="absolute -top-2 -left-1 font-serif text-3xl text-maserati-azul/20">"</span>
                            {comentarios[index] || "Muy emocionado por asistir a este gran evento."}
                        </p>

                    </article>
                ))}

            </div>
        </div>
    </section>
</Layout>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    // Esperamos a que el DOM esté totalmente cargado
    document.addEventListener("DOMContentLoaded", () => {
        
        // 1. Ahora sí, registramos el plugin con seguridad
        gsap.registerPlugin(ScrollTrigger);

        // 2. Ejecutamos las animaciones dentro del contexto
        gsap.context(() => {
            
            // Animación del Título
            gsap.to(".header-animate", {
                opacity: 1,
                y: 0,
                duration: 1,
                ease: "power3.out"
            });

            // Animación del Grid
            gsap.to(".community-card", {
                scrollTrigger: {
                    trigger: ".community-grid",
                    start: "top 80%",
                    toggleActions: "play none none reverse"
                },
                opacity: 1,
                y: 0,
                duration: 0.8,
                stagger: 0.15,
                ease: "power2.out"
            });
            
        }); 
    });
</script>